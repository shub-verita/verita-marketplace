generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Job {
  id                  String        @id @default(cuid())
  title               String
  slug                String        @unique
  status              JobStatus     @default(DRAFT)
  payMin              Int
  payMax              Int
  payType             PayType       @default(HOURLY)
  timeCommitment      String
  remoteWorldwide     Boolean       @default(true)
  allowedCountries    String[]
  shortDescription    String        @db.VarChar(200)
  fullDescription     String        @db.Text
  responsibilities    String        @db.Text
  requirements        String        @db.Text
  niceToHave          String?       @db.Text
  tools               String[]
  skillTags           String[]
  applicationDeadline DateTime?
  maxApplications     Int?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  publishedAt         DateTime?
  createdById         String?
  createdBy           User?         @relation(fields: [createdById], references: [id])
  applications        Application[]
}

model Application {
  id                 String            @id @default(cuid())
  jobId              String
  job                Job               @relation(fields: [jobId], references: [id])
  fullName           String
  email              String
  phone              String
  country            String
  resumeUrl          String
  linkedinUrl        String?
  portfolioUrl       String?
  whyInterested      String            @db.Text
  relevantExperience String            @db.Text
  source             ApplicationSource @default(OTHER)
  status             ApplicationStatus @default(NEW)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  notes              ApplicationNote[]
}

model ApplicationNote {
  id            String      @id @default(cuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id])
  authorId      String
  author        User        @relation(fields: [authorId], references: [id])
  noteText      String      @db.Text
  createdAt     DateTime    @default(now())
}

model User {
  id               String            @id @default(cuid())
  email            String            @unique
  passwordHash     String
  name             String
  role             UserRole          @default(OPS)
  createdAt        DateTime          @default(now())
  lastLogin        DateTime?
  jobs             Job[]
  applicationNotes ApplicationNote[]
}

enum JobStatus {
  DRAFT
  PUBLISHED
  CLOSED
}

enum PayType {
  HOURLY
  PER_TASK
}

enum ApplicationStatus {
  NEW
  REVIEWING
  SHORTLISTED
  REJECTED
  HIRED
}

enum ApplicationSource {
  LINKEDIN
  TWITTER
  REFERRAL
  GOOGLE
  OTHER
}

enum UserRole {
  OPS
  ADMIN
}
